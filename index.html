<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Tabungan, Pemasukan & Pengeluaran</title>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<style>
*{box-sizing:border-box;margin:0;padding:0;font-family:'Segoe UI',sans-serif;}
body{background:#f0f2f5;transition:.3s;}
body.dark-mode{background:#121212;color:#e0e0e0;}
body.dark-mode .card{background:#1f1f1f;color:#e0e0e0;}
body.dark-mode table th{background:#2c2c2c;}
#loginPage{display:flex;justify-content:center;align-items:center;height:100vh;position:relative;}
#loginPage::before{content:'';position:absolute;width:100%;height:100%;background:url('https://images.unsplash.com/photo-1522202176988-66273c2fd55f?fit=crop&w=1350&q=80') center/cover no-repeat;filter:blur(8px) brightness(0.6);z-index:0;}
#loginBox{position:relative;z-index:1;background: rgba(255,255,255,0.9);padding:40px;border-radius:12px;width:350px;text-align:center;box-shadow:0 10px 30px rgba(0,0,0,0.2);}
#loginBox input{width:100%;margin-bottom:15px;padding:12px;border-radius:8px;border:1px solid #ccc;}
#loginBox button{width:100%;padding:12px;border-radius:8px;border:none;background:linear-gradient(45deg,#4CAF50,#81C784);color:white;font-weight:bold;cursor:pointer;transition:0.3s;}
#loginBox button:hover{background:linear-gradient(45deg,#388E3C,#66BB6A);}
header{background:#4CAF50;color:white;padding:20px;text-align:center;position:relative;}
body.dark-mode header{background:#1f1f1f;color:#e0e0e0;}
#toggleMode{position:absolute;right:20px;top:20px;padding:6px 12px;font-size:.9em;background:#fff;border:none;border-radius:8px;cursor:pointer;font-weight:bold;transition:.3s;}
body.dark-mode #toggleMode{background:#333;color:#fff;}
.container{max-width:1000px;margin:30px auto;padding:0 15px;}
.card{background:white;border-radius:12px;padding:20px;margin-bottom:20px;box-shadow:0 5px 20px rgba(0,0,0,0.1);transition: background .3s,color .3s;}
body.dark-mode .card{background:#1f1f1f;}
.card h2{margin-bottom:15px;color:#333;font-size:1.2em;}
.card label{display:block;margin:10px 0 5px;font-weight:bold;}
.card input,.card select,.card button{width:100%;padding:10px;border-radius:8px;border:1px solid #ccc;margin-bottom:10px;}
.card button{background:linear-gradient(45deg,#4CAF50,#81C784);color:white;font-weight:bold;border:none;cursor:pointer;transition:0.3s;}
.card button:hover{background:linear-gradient(45deg,#388E3C,#66BB6A);}
.summary-container{display:flex;gap:20px;flex-wrap:wrap;margin-top:20px;}
.summary-card{flex:1;min-width:200px;padding:20px;border-radius:12px;text-align:center;font-weight:bold;color:#2e7d32;background:#e8f5e9;box-shadow:0 5px 15px rgba(0,0,0,0.1);transition:.3s;}
.summary-card.income{background:#e8f5e9;color:#2e7d32;}
.summary-card.expense{background:#ffebee;color:#c62828;}
.summary-card.saving{background:#fff3e0;color:#ef6c00;}
.summary-card.balance{background:#e3f2fd;color:#1565c0;}
body.dark-mode .summary-card{background:#2c2c2c;color:#e0e0e0;}
table{width:100%;border-collapse:collapse;margin-top:10px;}
th,td{padding:12px;text-align:left;border-bottom:1px solid #ddd;}
th{background:#4CAF50;color:white;}
tr:nth-child(even){background:#f9f9f9;}
tr:hover{background:#e0f7fa;}
body.dark-mode tr:nth-child(even){background:#2a2a2a;}
body.dark-mode tr:hover{background:#333;}
.fade-in{animation: fadeIn 0.5s ease;}
@keyframes fadeIn{from{opacity:0;} to{opacity:1;}}
canvas{margin-top:20px;background:#fff;border-radius:12px;padding:20px;}
body.dark-mode canvas{background:#1f1f1f;}
.receipt-img{width:60px;height:60px;object-fit:cover;border-radius:6px;cursor:pointer;transition:.2s;}
.receipt-img:hover{transform:scale(1.1);}
</style>
</head>
<body>

<!-- Login -->
<div id="loginPage">
    <div id="loginBox">
        <h2>Login</h2>
        <input type="text" id="username" placeholder="Username">
        <input type="password" id="password" placeholder="Password">
        <button onclick="login()">Masuk</button>
    </div>
</div>

<!-- Dashboard -->
<div id="app" style="display:none;">
<header>
    <h1>Tabungan & Transaksi Bulanan</h1>
    <button id="toggleMode" onclick="toggleDarkMode()">Mode Gelap</button>
</header>

<div class="container">
    <!-- Input -->
    <div class="card">
        <h2>Transaksi Baru</h2>
        <input type="hidden" id="editIndex">
        <label for="date">Tanggal:</label>
        <input type="date" id="date">

        <label for="type">Jenis:</label>
        <select id="type" onchange="showNoteAndImageField()">
            <option value="pemasukan">Pemasukan</option>
            <option value="tabungan">Tabungan</option>
            <option value="pengeluaran">Pengeluaran</option>
        </select>

        <label for="amount">Jumlah (Rp):</label>
        <input type="number" id="amount" placeholder="Masukkan jumlah">

        <label for="note" id="noteLabel">Catatan:</label>
        <input type="text" id="note" placeholder="Catatan transaksi">

        <label for="receipt" id="receiptLabel" style="display:none;">Bukti (Gambar):</label>
        <input type="file" id="receipt" accept="image/*" style="display:none;">

        <button onclick="saveTransaction()">Simpan</button>
    </div>

    <!-- Filter -->
    <div class="card">
        <h2>Filter</h2>
        <label for="startDate">Mulai:</label>
        <input type="date" id="startDate">
        <label for="endDate">Sampai:</label>
        <input type="date" id="endDate">
        <label for="typeFilter">Jenis:</label>
        <select id="typeFilter">
            <option value="">Semua</option>
            <option value="pemasukan">Pemasukan</option>
            <option value="tabungan">Tabungan</option>
            <option value="pengeluaran">Pengeluaran</option>
        </select>
        <button onclick="applyFilter()">Terapkan</button>
        <button onclick="exportCSV()">Export CSV</button>
        <button onclick="exportJSON()">Export JSON</button>
    </div>

    <!-- Summary -->
    <div class="summary-container">
        <div class="summary-card income" id="totalIncome">Total Pemasukan: Rp 0</div>
        <div class="summary-card saving" id="totalSaving">Total Tabungan: Rp 0</div>
        <div class="summary-card expense" id="totalExpense">Total Pengeluaran: Rp 0</div>
        <div class="summary-card balance" id="balance">Saldo Akhir: Rp 0</div>
    </div>

    <!-- Table -->
    <div class="card">
        <h2>Riwayat</h2>
        <table>
            <thead>
                <tr>
                    <th>Tanggal</th>
                    <th>Jenis</th>
                    <th>Jumlah</th>
                    <th>Catatan</th>
                    <th>Bukti</th>
                    <th>Aksi</th>
                </tr>
            </thead>
            <tbody id="transactionTable"></tbody>
        </table>
    </div>

    <!-- Chart -->
    <div class="card">
        <h2>Grafik Saldo</h2>
        <canvas id="myChart" width="400" height="200"></canvas>
    </div>
</div>
</div>

<script>
window.onload=function(){
    let transactions=[],filteredTransactions=[],chart;

    if(localStorage.getItem('transactions')) transactions=JSON.parse(localStorage.getItem('transactions'));

    // Login
    window.login=function(){
        const u=document.getElementById('username').value;
        const p=document.getElementById('password').value;
        if(u==='admin' && p==='1234'){
            document.getElementById('loginPage').style.display='none';
            document.getElementById('app').style.display='block';
            applyFilter();
        }else alert('Username atau password salah!');
    }

    // Show/hide receipt
    window.showNoteAndImageField=function(){
        const t=document.getElementById('type').value;
        const r=document.getElementById('receipt');
        const rl=document.getElementById('receiptLabel');
        if(t==='pengeluaran'){r.style.display='block'; rl.style.display='block';}
        else{r.style.display='none'; rl.style.display='none'; r.value='';}
    }

    // Save transaction with Base64 image
    window.saveTransaction=function(){
        const date=document.getElementById('date').value;
        const type=document.getElementById('type').value;
        const amount=Number(document.getElementById('amount').value);
        const note=document.getElementById('note').value;
        const editIndex=document.getElementById('editIndex').value;

        if(!date || !amount){alert('Tanggal dan jumlah wajib diisi!'); return;}

        const file=document.getElementById('receipt').files[0];
        if(file){
            const reader=new FileReader();
            reader.onload=function(e){
                const receipt=e.target.result;
                saveTransactionData(date,type,amount,note,receipt,editIndex);
            }
            reader.readAsDataURL(file);
        }else saveTransactionData(date,type,amount,note,'',editIndex);
    }

    function saveTransactionData(date,type,amount,note,receipt,editIndex){
        if(editIndex!==''){ // edit
            transactions[editIndex]={date,type,amount,note,receipt};
        }else transactions.push({date,type,amount,note,receipt});
        localStorage.setItem('transactions',JSON.stringify(transactions));
        resetForm();
        applyFilter();
    }

    function resetForm(){
        document.getElementById('date').value='';
        document.getElementById('type').value='pemasukan';
        document.getElementById('amount').value='';
        document.getElementById('note').value='';
        document.getElementById('receipt').value='';
        document.getElementById('editIndex').value='';
        showNoteAndImageField();
    }

    // Apply filter
    window.applyFilter=function(){
        const start=document.getElementById('startDate').value;
        const end=document.getElementById('endDate').value;
        const typeFilter=document.getElementById('typeFilter').value;
        filteredTransactions=transactions.filter(t=>{
            return (!start || t.date>=start) && (!end || t.date<=end) && (!typeFilter || t.type===typeFilter);
        });
        updateTable();
        updateSummary();
        updateChart();
    }

    // Update table
    function updateTable(){
        const tbody=document.getElementById('transactionTable');
        tbody.innerHTML='';
        filteredTransactions.forEach((t,i)=>{
            const tr=document.createElement('tr');
            tr.innerHTML=`
                <td>${t.date}</td>
                <td>${t.type}</td>
                <td>Rp ${t.amount.toLocaleString()}</td>
                <td>${t.note}</td>
                <td>${t.receipt?'<img src="'+t.receipt+'" class="receipt-img" onclick="window.open(\''+t.receipt+'\',\'_blank\')">':''}</td>
                <td>
                    <button onclick="editTransaction(${i})">Edit</button>
                    <button onclick="deleteTransaction(${i})">Hapus</button>
                </td>`;
            tbody.appendChild(tr);
        });
    }

    window.editTransaction=function(i){
        const t=filteredTransactions[i];
        const index=transactions.indexOf(t);
        document.getElementById('editIndex').value=index;
        document.getElementById('date').value=t.date;
        document.getElementById('type').value=t.type;
        document.getElementById('amount').value=t.amount;
        document.getElementById('note').value=t.note;
        showNoteAndImageField();
    }

    window.deleteTransaction=function(i){
        if(confirm('Hapus transaksi ini?')){
            const t=filteredTransactions[i];
            const index=transactions.indexOf(t);
            transactions.splice(index,1);
            localStorage.setItem('transactions',JSON.stringify(transactions));
            applyFilter();
        }
    }

    // Update summary (saldo = pemasukan - tabungan - pengeluaran)
    function updateSummary(){
        let income=0, saving=0, expense=0;
        filteredTransactions.forEach(t=>{
            if(t.type==='pemasukan') income+=t.amount;
            else if(t.type==='tabungan') saving+=t.amount;
            else if(t.type==='pengeluaran') expense+=t.amount;
        });
        document.getElementById('totalIncome').innerText='Total Pemasukan: Rp '+income.toLocaleString();
        document.getElementById('totalSaving').innerText='Total Tabungan: Rp '+saving.toLocaleString();
        document.getElementById('totalExpense').innerText='Total Pengeluaran: Rp '+expense.toLocaleString();
        document.getElementById('balance').innerText='Saldo Akhir: Rp '+(income - saving - expense).toLocaleString();
    }

    // Chart
    function updateChart(){
        if(chart) chart.destroy();
        const labels = filteredTransactions.map(t=>t.date);
        let bal=0;
        const data = filteredTransactions.map(t=>{
            if(t.type==='pemasukan') bal += t.amount;
            else if(t.type==='tabungan') bal -= t.amount;
            else if(t.type==='pengeluaran') bal -= t.amount;
            return bal;
        });
        const ctx=document.getElementById('myChart').getContext('2d');
        chart=new Chart(ctx,{
            type:'line',
            data:{labels,datasets:[{label:'Saldo',data,borderColor:'#4CAF50',backgroundColor:'rgba(76,175,80,0.2)',fill:true}]},
            options:{responsive:true,plugins:{legend:{display:false}}}
        });
    }

    // Dark mode
    window.toggleDarkMode=function(){
        document.body.classList.toggle('dark-mode');
    }

    // Export
    window.exportCSV=function(){
        let csv='Tanggal,Jenis,Jumlah,Catatan\\n';
        filteredTransactions.forEach(t=>{
            csv+=`${t.date},${t.type},${t.amount},"${t.note}"\\n`;
        });
        const blob=new Blob([csv],{type:'text/csv'});
        const a=document.createElement('a');
        a.href=URL.createObjectURL(blob);
        a.download='transaksi.csv';
        a.click();
    }

    window.exportJSON=function(){
        const blob=new Blob([JSON.stringify(filteredTransactions,null,2)],{type:'application/json'});
        const a=document.createElement('a');
        a.href=URL.createObjectURL(blob);
        a.download='transaksi.json';
        a.click();
    }
};
</script>
</body>
</html>
